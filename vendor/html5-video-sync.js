var videoSynchronizer=function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){"use strict";function i(e,t,n){return new r.a(e,t,n)}Object.defineProperty(t,"__esModule",{value:!0}),t.sync=i;var r=n(1)},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var i=n(2),r=(n.n(i),n(6)),o={syncDeviationThreshold:80,maxSyncDeviationThreshold:2e3},s=function(){function e(e,t,n){void 0===n&&(n=o),this.mainVideoElement=e,this.syncedVideoElements=t,this.eventRegistry=new r.a,this.options=n,this.lastActions=[],this.rafCountSinceLastSyncFix=0,this.synchronizing=!1,this.handlePlay=this.handlePlay.bind(this),this.handlePause=this.handlePause.bind(this),this.handleSeek=this.handleSeek.bind(this),this.handleSynchronized=this.handleSynchronized.bind(this),this.handleSynchronizing=this.handleSynchronizing.bind(this),this.handleFixVideoSynchronization=this.handleFixVideoSynchronization.bind(this),this.handleRateChange=this.handleRateChange.bind(this),this.initialize()}return e.prototype.initialize=function(){this.addListeners(),this.refresh();for(var e=0,t=this.syncedVideoElements;e<t.length;e++){t[e].playbackRate=this.mainVideoElement.playbackRate}},e.prototype.destroy=function(){this.removeListeners()},e.prototype.dispatchEvent=function(e,t){var n;"function"==typeof Event?n=new Event(t):(n=document.createEvent("Event"),n.initEvent(t,!1,!0)),e.dispatchEvent(n)},e.prototype.isSynced=function(){if(this.mainVideoElement.readyState<4)return!1;for(var e=0,t=this.syncedVideoElements;e<t.length;e++){var n=t[e];if(this.processSyncedVideoDeviation(n)>this.options.syncDeviationThreshold)return!1;if(n.readyState<4)return!1}return!0},e.prototype.registerAction=function(e){this.synchronizing||(this.lastActions.unshift({timecode:1e3*this.mainVideoElement.currentTime,action:e}),this.lastActions=this.lastActions.slice(0,5))},e.prototype.dispatchSyncEvent=function(e){var t=this;this.dispatchEvent(this.mainVideoElement,e),this.syncedVideoElements.forEach(function(n){t.dispatchEvent(n,e)})},e.prototype.pauseAll=function(){this.syncedVideoElements.forEach(function(e){e.pause()}),this.mainVideoElement.paused||this.mainVideoElement.pause()},e.prototype.playAll=function(){this.mainVideoElement.paused&&this.mainVideoElement.play(),this.syncedVideoElements.forEach(function(e){e.play()})},e.prototype.processSyncedVideoDeviation=function(e){return Math.abs(1e3*(this.mainVideoElement.currentTime-e.currentTime))},e.prototype.refresh=function(){var e=this;this.rafCountSinceLastSyncFix++>25&&(this.rafCountSinceLastSyncFix=0,this.testAndFixSync()),i(function(){e.refresh()})},e.prototype.testAndFixSync=function(){if(this.isSynced()){if(!this.synchronizing)return;return this.synchronizing=!1,this.dispatchSyncEvent("synchronized")}this.synchronizing||(this.synchronizing=!0,this.dispatchSyncEvent("synchronizing"));for(var e=0,t=this.syncedVideoElements;e<t.length;e++){var n=t[e];this.processSyncedVideoDeviation(n)>this.options.maxSyncDeviationThreshold&&this.pauseAll(),this.dispatchEvent(n,"fix-synchronization")}},e.prototype.handleFixVideoSynchronization=function(e){var t=e.target;if(!(this.mainVideoElement.readyState<4&&t.readyState<4)){var n=this.processSyncedVideoDeviation(t);console.log("Resync video (main video, synced video, deviation)",Math.round(1e3*this.mainVideoElement.currentTime),Math.round(1e3*t.currentTime),n),t.currentTime=this.mainVideoElement.currentTime}},e.prototype.handleSynchronizing=function(){},e.prototype.handleRateChange=function(e){for(var t=0,n=this.syncedVideoElements;t<n.length;t++){n[t].playbackRate=this.mainVideoElement.playbackRate}},e.prototype.wasPlayingBeforeSync=function(){if(0==this.lastActions.length)return!1;if("play"===this.lastActions[0].action)return!0;if(this.lastActions.length>2&&"seek"===this.lastActions[0].action)for(var e=this.lastActions[0].timecode,t=0,n=this.lastActions.slice(1);t<n.length;t++){var i=n[t];if(Math.abs(e-i.timecode)>500)return"play"===i.action}return!1},e.prototype.handleSynchronized=function(){this.wasPlayingBeforeSync()?this.mainVideoElement.play():this.mainVideoElement.pause()},e.prototype.handleSeek=function(){this.registerAction("seek")},e.prototype.handlePlay=function(e){this.registerAction("play"),this.synchronizing&&e.preventDefault(),this.playAll()},e.prototype.handlePause=function(){this.registerAction("pause"),this.pauseAll()},e.prototype.addListeners=function(){var e=this;this.eventRegistry.register(this.mainVideoElement,"synchronizing",this.handleSynchronizing),this.eventRegistry.register(this.mainVideoElement,"synchronized",this.handleSynchronized),this.eventRegistry.register(this.mainVideoElement,"play",this.handlePlay),this.eventRegistry.register(this.mainVideoElement,"pause",this.handlePause),this.eventRegistry.register(this.mainVideoElement,"seeking",this.handleSeek),this.eventRegistry.register(this.mainVideoElement,"ratechange",this.handleRateChange),this.syncedVideoElements.forEach(function(t){e.eventRegistry.register(t,"fix-synchronization",e.handleFixVideoSynchronization)})},e.prototype.removeListeners=function(){this.eventRegistry.unregisterAll()},e}()},function(e,t,n){(function(t){for(var i=n(4),r="undefined"==typeof window?t:window,o=["moz","webkit"],s="AnimationFrame",a=r["request"+s],c=r["cancel"+s]||r["cancelRequest"+s],h=0;!a&&h<o.length;h++)a=r[o[h]+"Request"+s],c=r[o[h]+"Cancel"+s]||r[o[h]+"CancelRequest"+s];if(!a||!c){var u=0,l=0,d=[];a=function(e){if(0===d.length){var t=i(),n=Math.max(0,1e3/60-(t-u));u=n+t,setTimeout(function(){var e=d.slice(0);d.length=0;for(var t=0;t<e.length;t++)if(!e[t].cancelled)try{e[t].callback(u)}catch(e){setTimeout(function(){throw e},0)}},Math.round(n))}return d.push({handle:++l,callback:e,cancelled:!1}),l},c=function(e){for(var t=0;t<d.length;t++)d[t].handle===e&&(d[t].cancelled=!0)}}e.exports=function(e){return a.call(r,e)},e.exports.cancel=function(){c.apply(r,arguments)},e.exports.polyfill=function(e){e||(e=r),e.requestAnimationFrame=a,e.cancelAnimationFrame=c}}).call(t,n(3))},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){(function(t){(function(){var n,i,r,o,s,a;"undefined"!=typeof performance&&null!==performance&&performance.now?e.exports=function(){return performance.now()}:void 0!==t&&null!==t&&t.hrtime?(e.exports=function(){return(n()-s)/1e6},i=t.hrtime,n=function(){var e;return e=i(),1e9*e[0]+e[1]},o=n(),a=1e9*t.uptime(),s=o-a):Date.now?(e.exports=function(){return Date.now()-r},r=Date.now()):(e.exports=function(){return(new Date).getTime()-r},r=(new Date).getTime())}).call(this)}).call(t,n(5))},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function r(e){if(u===setTimeout)return setTimeout(e,0);if((u===n||!u)&&setTimeout)return u=setTimeout,setTimeout(e,0);try{return u(e,0)}catch(t){try{return u.call(null,e,0)}catch(t){return u.call(this,e,0)}}}function o(e){if(l===clearTimeout)return clearTimeout(e);if((l===i||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(e);try{return l(e)}catch(t){try{return l.call(null,e)}catch(t){return l.call(this,e)}}}function s(){p&&f&&(p=!1,f.length?y=f.concat(y):m=-1,y.length&&a())}function a(){if(!p){var e=r(s);p=!0;for(var t=y.length;t;){for(f=y,y=[];++m<t;)f&&f[m].run();m=-1,t=y.length}f=null,p=!1,o(e)}}function c(e,t){this.fun=e,this.array=t}function h(){}var u,l,d=e.exports={};!function(){try{u="function"==typeof setTimeout?setTimeout:n}catch(e){u=n}try{l="function"==typeof clearTimeout?clearTimeout:i}catch(e){l=i}}();var f,y=[],p=!1,m=-1;d.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];y.push(new c(e,t)),1!==y.length||p||r(a)},c.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=h,d.addListener=h,d.once=h,d.off=h,d.removeListener=h,d.removeAllListeners=h,d.emit=h,d.prependListener=h,d.prependOnceListener=h,d.listeners=function(e){return[]},d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i=function(){function e(){this.eventListeners=[]}return e.prototype.register=function(e,t,n){this.eventListeners.push({target:e,eventType:t,listener:n}),e.addEventListener(t,n)},e.prototype.unregister=function(e){this.eventListeners.forEach(function(t){t.eventType==e&&t.target.removeEventListener(t.eventType,t.listener)}),this.eventListeners.filter(function(t){return t.eventType!=e})},e.prototype.unregisterAll=function(){this.eventListeners.forEach(function(e){e.target.removeEventListener(e.eventType,e.listener)}),this.eventListeners=[]},e}()}]);